#!/bin/sh

case "$0" in
	*/*) base=${0%/*} ;;
	*) echo "$0 may not be called from PATH" >&2; exit 1 ;;
esac

needslib=yes

for _ in "$@"; do
	case "$_" in
		-c|-E|-S) unset needslib ;;
	esac
done

exec "CC" -fno-strict-aliasing -fno-asynchronous-unwind-tables \
	-nostdinc -I"$base/lib/arch/ARCH" -I"$base/lib" \
	CFLAGS "$@" \
	-nostdlib ${needslib:+"$base/lib/all.a" -lgcc}
